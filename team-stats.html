<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Team Statistics</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
body {
    background:#0f0f0f;
    color:#fff;
    font-family:'Cairo', Arial, sans-serif;
    font-weight:700;
    padding:20px;
}

h2 {
    text-align:center;
    margin-bottom:20px;
}

.team-tabs {
    display: flex;
    flex-wrap: wrap; /* لو الفرق كتير، يبقى سطر جديد */
    margin-bottom: 20px;
    justify-content: center;
}

.team-tab {
    background: #2b2b2b;
    color: #fff;
    padding: 8px 15px;
    margin: 2px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 700;
    transition: background 0.3s;
}

.team-tab:hover {
    background: #444;
}

.team-tab.active {
    background: #ffcc00;
    color: #000;
}

.stats {
    display: flex;
    justify-content: space-between; /* يمين ويسار */
    margin-top: 20px;
    font-size: 16px;
}

.stats-left, .stats-right {
    width: 48%; /* نص تقريبا لكل جزء */
}

.stats-left div, .stats-right div {
    margin-bottom: 8px;
}
</style>
</head>
<body>

<h2>Team Statistics</h2>

<div id="teamTabs" class="team-tabs">
    <!-- أسماء الفرق تتحول لتابات هنا -->
</div>

<div class="stats" id="statsDisplay">
    <div class="stats-left"></div>
    <div class="stats-right"></div>
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=866991516&single=true&output=csv&t=" + Date.now();

function parseCSV(text) {
    return text.trim().split("\n").map(row =>
        row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(col => col.replace(/^"|"$/g, ''))
    );
}

const teamTabs = document.getElementById("teamTabs");
const statsDisplay = document.getElementById("statsDisplay");
let allData = [];

fetch(sheetURL, {cache: "no-store"})
.then(res => res.text())
.then(csv => {
    allData = parseCSV(csv).slice(1); // تجاهل الهيدر

    // جمع أسماء الفرق بدون تكرار وتجاهل أي كلمة خاطئة
    const teams = new Set();
    allData.forEach(match => {
        const home = match[2]?.trim();
        const away = match[11]?.trim();
        if(home && home.toLowerCase() !== "lose") teams.add(home);
        if(away && away.toLowerCase() !== "lose") teams.add(away);
    });

    // إنشاء التابات
    teams.forEach(team => {
        const tab = document.createElement("div");
        tab.textContent = team;
        tab.classList.add("team-tab");
        tab.addEventListener("click", () => showTeamStats(team, tab));
        teamTabs.appendChild(tab);
    });
});

// دالة عرض الإحصائيات + الأهداف + فارق الأهداف + النقاط + اللاعبين
function showTeamStats(team, clickedTab) {
    // تفعيل تاب واحد فقط
    document.querySelectorAll(".team-tab").forEach(t => t.classList.remove("active"));
    clickedTab.classList.add("active");

    let played = 0, won = 0, draw = 0, lost = 0, goalsFor = 0, goalsAgainst = 0;

    allData.forEach(match => {
        const status = match[15]?.trim(); // Match Status
        const homeTeam = match[2];
        const awayTeam = match[11];
        const homeScore = parseInt(match[6]);
        const awayScore = parseInt(match[7]);

        if(status !== "Played") return;

        if(homeTeam === team || awayTeam === team){
            played++;

            if(homeScore === awayScore) draw++;
            else if((homeTeam === team && homeScore > awayScore) || (awayTeam === team && awayScore > homeScore)) won++;
            else lost++;

            if(homeTeam === team){
                goalsFor += homeScore;
                goalsAgainst += awayScore;
            } else {
                goalsFor += awayScore;
                goalsAgainst += homeScore;
            }
        }
    });

    const goalDiff = goalsFor - goalsAgainst;
    const points = won * 3 + draw * 1;

    // اللاعبين (مثال ثابت)
    const players = ["Ahmed Ibrahem", "Abdoulrahman Atef"];

    statsDisplay.innerHTML = `
        <div class="stats-left">
            <div>Played: ${played}</div>
            <div>Won: ${won}</div>
            <div>Draw: ${draw}</div>
            <div>Lost: ${lost}</div>
            <div>Goals For: ${goalsFor}</div>
            <div>Goals Against: ${goalsAgainst}</div>
            <div>Goal Difference: ${goalDiff}</div>
            <div>Points: ${points}</div>
        </div>
        <div class="stats-right">
            <div>Players:</div>
            ${players.map(p => `<div>${p}</div>`).join('')}
        </div>
    `;
}
</script>

</body>
</html>
