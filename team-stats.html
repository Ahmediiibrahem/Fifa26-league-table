<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Team Stats</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="icon" type="image/jpeg" href="fifa26.jpeg">

<style>
body{
    font-family:'Cairo',Arial,sans-serif;
    background:linear-gradient(rgba(15,15,15,.85),rgba(15,15,15,.85)),url("standings-bg.jpg");
    background-size:cover;
    background-attachment:fixed;
    color:#fff;
    font-weight:700;
}

/* ===== Header ===== */
.page-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 30px;
}
.owner-header{text-align:center;}
.header-logo{height:100px;}
.owner-points{
    margin-top:6px;
    font-size:14px;
    font-weight:800;
    color:#f1c40f;
}

/* ===== Navbar ===== */
nav{
    display:flex;
    justify-content:center;
    gap:20px;
    margin:20px 0;
}
nav a{
    text-decoration:none;
    color:#fff;
    background:#2b2b2b;
    padding:10px 25px;
    border-radius:8px;
}
nav a.active,nav a:hover{background:#3498db;}

/* ===== Levels ===== */
.level{
    max-width:1100px;
    margin:25px auto;
}
.level h3{
    margin-bottom:12px;
    color:#f1c40f;
}
.team-tabs{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:12px;
}
.team-tab{
    background:#2b2b2b;
    padding:12px;
    border-radius:12px;
    cursor:pointer;
    display:flex;
    justify-content:space-between;
    align-items:center;
    transition:.3s;
}
.team-tab:hover,.team-tab.active{background:#3498db;}
.team-name{font-size:14px;}
.team-points{
    width:28px;
    height:28px;
    border-radius:50%;
    background:#f1c40f;
    color:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:13px;
    font-weight:800;
}

/* ===== Stats ===== */
.stats{
    display:none;
    max-width:950px;
    margin:35px auto;
    background:rgba(0,0,0,.5);
    padding:30px;
    border-radius:18px;
    gap:30px;
}
.stats-left,.stats-right{width:50%;}

.stats-grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:15px;
}
.stat-card{
    background:#1f1f1f;
    padding:15px;
    border-radius:12px;
    text-align:center;
}
.stat-card span{
    display:block;
    font-size:22px;
    color:#f1c40f;
}
.stat-card small{
    font-size:13px;
    opacity:.85;
}

.stats-right div{margin-bottom:10px;}
</style>
</head>

<body>

<div class="page-header">
    <div class="owner-header">
        <img src="left-logo.png" class="header-logo">
        <div id="ahmedPts" class="owner-points">Points: 0</div>
    </div>
    <div class="owner-header">
        <img src="right-logo.png" class="header-logo">
        <div id="abdoPts" class="owner-points">Points: 0</div>
    </div>
</div>

<nav>
    <a href="index.html">Standings</a>
    <a href="matches.html">Results</a>
    <a href="upcoming.html">Upcoming</a>
    <a href="team-stats.html" class="active">Stats</a>
</nav>

<div id="levels"></div>
<div id="statsDisplay" class="stats"></div>

<script>
const matchesURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=866991516&single=true&output=csv&t="+Date.now();
const teamsURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=0&single=true&output=csv&t="+Date.now();

function parseCSV(t){
    return t.trim().split("\n").map(r=>r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'')));
}

let matches=[],teams=[];

Promise.all([
fetch(matchesURL).then(r=>r.text()),
fetch(teamsURL).then(r=>r.text())
]).then(([m,t])=>{
matches=parseCSV(m).slice(1);
teams=parseCSV(t).slice(1).map(r=>({
    name:r[1],country:r[3],level:r[5],owner:r[6],rank:r[7],points:0
}));

calcTeamPoints();
renderLevels();
calcOwnerPoints();
});

function calcTeamPoints(){
teams.forEach(team=>{
let pts=0;
matches.forEach(m=>{
if(m[15]!=="Played")return;
const h=m[2],a=m[11],hs=+m[6],as=+m[7];
if(h===team.name||a===team.name){
if(hs===as)pts+=1;
else if((h===team.name&&hs>as)||(a===team.name&&as>hs))pts+=3;
}
});
team.points=pts;
});
}

function renderLevels(){
const container=document.getElementById("levels");
[1,2,3,4].forEach(level=>{
const block=document.createElement("div");
block.className="level";
block.innerHTML=`<h3>Level ${level}</h3><div class="team-tabs"></div>`;

teams.filter(t=>t.level==level)
.sort((a,b)=>b.points-a.points)
.forEach(team=>{
const tab=document.createElement("div");
tab.className="team-tab";
tab.innerHTML=`
<span class="team-name">${team.name}</span>
<span class="team-points">${team.points}</span>`;
tab.onclick=(e)=>showStats(team,tab);
block.querySelector(".team-tabs").appendChild(tab);
});
container.appendChild(block);
});
}

function showStats(team,tab){
document.querySelectorAll(".team-tab").forEach(t=>t.classList.remove("active"));
tab.classList.add("active");

let p=w=d=l=gf=ga=0;
matches.forEach(m=>{
if(m[15]!=="Played")return;
const h=m[2],a=m[11],hs=+m[6],as=+m[7];
if(h===team.name||a===team.name){
p++;
if(hs===as)d++;
else if((h===team.name&&hs>as)||(a===team.name&&as>hs))w++;
else l++;
if(h===team.name){gf+=hs;ga+=as}else{gf+=as;ga+=hs}
}
});

const box=document.getElementById("statsDisplay");
box.style.display="flex";
box.innerHTML=`
<div class="stats-left">
<div class="stats-grid">
<div class="stat-card"><span>${p}</span><small>Played</small></div>
<div class="stat-card"><span>${w}</span><small>Won</small></div>
<div class="stat-card"><span>${d}</span><small>Draw</small></div>
<div class="stat-card"><span>${l}</span><small>Lost</small></div>
<div class="stat-card"><span>${gf}</span><small>Goals For</small></div>
<div class="stat-card"><span>${ga}</span><small>Goals Against</small></div>
<div class="stat-card"><span>${gf-ga}</span><small>Goal Diff</small></div>
<div class="stat-card"><span>${team.points}</span><small>Points</small></div>
</div>
</div>

<div class="stats-right">
<div><b>Team:</b> ${team.name}</div>
<div><b>Owner:</b> ${team.owner}</div>
<div><b>Country:</b> ${team.country}</div>
<div><b>Level:</b> ${team.level}</div>
<div><b>International Rank:</b> ${team.rank}</div>
</div>`;
}

function calcOwnerPoints(){
let ah=0,ab=0;
teams.forEach(t=>{
if(t.owner==="Ahmed Ibrahem")ah+=t.points;
if(t.owner==="Abdoulrahman Atef")ab+=t.points;
});
document.getElementById("ahmedPts").textContent="Points: "+ah;
document.getElementById("abdoPts").textContent="Points: "+ab;
}
</script>

</body>
</html>
