<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>League Table</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="icon" type="image/jpeg" href="FaviconFifa26.jpeg">

<style>
/* ===== HEADER ===== */
.page-header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;}
.logo-box{text-align:center;cursor:pointer;}
.header-logo{height:100px;object-fit:contain;}
.player-points{margin-top:5px;font-size:16px;font-weight:700}

/* ===== NAV ===== */
nav{display:flex;justify-content:center;gap:20px;margin-bottom:20px;flex-wrap:wrap}
nav a{
  text-decoration:none;color:#fff;font-weight:700;
  padding:10px 25px;border-radius:8px;
  background:#2b2b2b;transition:.3s
}
nav a:hover{background:#3498db;transform:scale(1.05)}
nav a.active{background:#3498db;box-shadow:0 4px 8px rgba(0,0,0,.3)}

/* ===== BODY ===== */
body{
  font-family:'Cairo',Arial,sans-serif;
  color:#fff;font-weight:700;margin:0;
  background:linear-gradient(rgba(15,15,15,.85),rgba(15,15,15,.85)),url("standings-bg.jpg");
  background-size:cover;background-attachment:fixed;
}

h2{text-align:center;margin-bottom:15px;font-weight:800}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse;font-size:14px}
th{background:#2b2b2b;padding:10px;font-weight:800;text-align:center}
td{padding:8px;text-align:center}
tr:nth-child(even){background:#1a1a1a}

.rank{
  background:#3a3a3a;
  font-weight:800;
}

/* عمود اللوجو – أفتح شوية من # */
.logo-col{
  background:rgba(58,58,58,.6);
}

/* ===== TEAM NAME ===== */
.team-name{
  text-align:left;
  padding-left:10px;
  white-space:nowrap;
}

/* ===== TEAM LOGOS ===== */
.team-logo{
  object-fit:contain;
  filter:drop-shadow(0 2px 6px rgba(0,0,0,.6));
}
.logo-1{width:34px;height:34px;}
.logo-2{width:30px;height:30px;}
.logo-3{width:28px;height:28px;}
.logo-rest{width:24px;height:24px;}

/* ===== FORM ===== */
.form-box{display:flex;justify-content:center;gap:3px}
.form-box div{
  width:18px;height:18px;line-height:18px;
  font-size:12px;font-weight:800;
  border-radius:3px;color:#fff;
}
.form-W{background:#27ae60}
.form-L{background:#e74c3c}
.form-D{background:#7f8c8d}

/* ===== RULES ===== */
.rules-container{width:90%;margin:20px auto}
.rules-toggle{
  width:100%;background:#2b2b2b;color:#fff;
  border:none;padding:12px 20px;font-size:16px;
  font-weight:700;border-radius:8px;cursor:pointer;
  display:flex;justify-content:space-between
}
.rules-toggle:hover{background:#3498db}
.rules-content{
  max-height:0;overflow:hidden;transition:.5s;
  background:#1a1a1a;padding:0 20px;border-radius:8px
}
.rules-content.open{max-height:500px;padding:15px 20px}
</style>
</head>

<body>

<div class="page-header">
  <div class="logo-box">
    <img src="left-logo.png" class="header-logo left">
    <div class="player-points" id="left-points">Points: 0</div>
  </div>
  <div class="logo-box">
    <img src="right-logo.png" class="header-logo right">
    <div class="player-points" id="right-points">Points: 0</div>
  </div>
</div>

<nav>
  <a href="index.html" class="active">Standings</a>
  <a href="matches.html">Results</a>
  <a href="upcoming.html">Upcoming</a>
  <a href="team-stats.html">Stats</a>
  <a href="scorers.html">Scorers</a>
</nav>

<h2>League Table</h2>

<table>
<thead>
<tr>
  <th>#</th>
  <th colspan="2">Team</th>
  <th>P</th>
  <th>W</th>
  <th>D</th>
  <th>L</th>
  <th>DIFF</th>
  <th>G/S</th>
  <th>G/C</th>
  <th>Points</th>
  <th>Owner</th>
  <th>Form</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="rules-container">
<button class="rules-toggle">Rules ▼</button>
<div class="rules-content">
  <ol>
    <li>Points</li>
    <li>Goal Difference</li>
    <li>Goals Scored</li>
    <li>Goals Conceded</li>
  </ol>
</div>
</div>

<script>
const standingsURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=1129539507&single=true&output=csv";

const formURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=882748508&single=true&output=csv";

function parseCSV(t){
  return t.trim().split("\n").map(r =>
    r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,"").trim())
  );
}

function teamLogoSrc(name){
  return `logos/${encodeURIComponent(name)}.png`;
}

/* ✅ يدعم: W / Win / Won — L / Lost / Loss — D / Draw */
function normalizeResult(value){
  const v = String(value || "").trim().toLowerCase();
  if(!v) return "";
  if(v === "w" || v === "win" || v === "won") return "W";
  if(v === "l" || v === "lost" || v === "loss" || v === "lose") return "L";
  if(v === "d" || v === "draw" || v === "tie") return "D";
  return "";
}

/* ===== LOAD FORM + STANDINGS TOGETHER (FIXED + NO CACHE) ===== */
Promise.all([
  fetch(formURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text()),
  fetch(standingsURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text())
]).then(([formCSV, standingsCSV])=>{

  const formParsed = parseCSV(formCSV);
  const formHeaders = (formParsed[0] || []).slice(1).map(h=>h.trim().toLowerCase());
  const formData = formParsed.slice(1).map(r=>r.slice(1));

  const rows = parseCSV(standingsCSV).slice(1,18);
  const tbody = document.querySelector("tbody");
  tbody.innerHTML = "";

  const pointsByOwner = {};

  rows.forEach((c,i)=>{
    if(!c[3]) return;

    const team = (c[2] || "").trim();
    const owner = c[11];
    const pts = +c[10] || 0;

    pointsByOwner[owner] = (pointsByOwner[owner]||0) + pts;

    let logoClass =
      i===0 ? "logo-1" :
      i===1 ? "logo-2" :
      i===2 ? "logo-3" : "logo-rest";

    // ===== FORM =====
    let idx = formHeaders.indexOf(team.toLowerCase());
    let formHTML = "";

    if(idx > -1){
      formHTML = '<div class="form-box">';
      formData.forEach(r=>{
        const res = normalizeResult(r[idx]);
        if(res === "W") formHTML += '<div class="form-W">W</div>';
        else if(res === "L") formHTML += '<div class="form-L">L</div>';
        else if(res === "D") formHTML += '<div class="form-D">D</div>';
      });
      formHTML += '</div>';
    }

    tbody.innerHTML += `
    <tr>
      <td class="rank">${i+1}</td>
      <td class="logo-col">
        <img class="team-logo ${logoClass}"
             src="${teamLogoSrc(team)}"
             alt="${team}"
             onerror="this.style.display='none'">
      </td>
      <td class="team-name">${team}</td>
      <td>${c[3]}</td>
      <td>${c[4]}</td>
      <td>${c[5]}</td>
      <td>${c[6]}</td>
      <td>${c[7]}</td>
      <td>${c[8]}</td>
      <td>${c[9]}</td>
      <td>${c[10]}</td>
      <td>${c[11]}</td>
      <td>${formHTML}</td>
    </tr>`;
  });

  document.getElementById("left-points").textContent =
    "Points: " + (pointsByOwner["Ahmed Ibrahem"]||0);
  document.getElementById("right-points").textContent =
    "Points: " + (pointsByOwner["Abdoulrahman Atef"]||0);
})
.catch(err => console.error("Error loading sheets:", err));

document.querySelector(".rules-toggle").onclick=()=>{
  document.querySelector(".rules-content").classList.toggle("open");
};
</script>

</body>
</html>
