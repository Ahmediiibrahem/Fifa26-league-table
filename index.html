<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>League Table</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="icon" type="image/jpeg" href="assets/img/FaviconFifa26.jpeg">

<style>
/* ===== HEADER ===== */
.page-header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;}
.logo-box{text-align:center;cursor:pointer;}
.header-logo{height:100px;object-fit:contain;}
.player-points{
  margin-top:5px;
  font-family:'Cairo', Arial, sans-serif;
  font-weight:800;
  font-size:14px;
  color:#fff;
  opacity:.95;
}

/* ===== NAV ===== */
nav{display:flex;justify-content:center;gap:20px;margin-bottom:20px;flex-wrap:wrap}
nav a{
  text-decoration:none;color:#fff;font-weight:700;
  padding:10px 25px;border-radius:8px;
  background:#2b2b2b;transition:.3s
}
nav a:hover{background:#3498db;transform:scale(1.05)}
nav a.active{background:#3498db;box-shadow:0 4px 8px rgba(0,0,0,.3)}

/* ===== BODY ===== */
body{
  font-family:'Cairo',Arial,sans-serif;
  color:#fff;font-weight:700;margin:0;
  background:linear-gradient(rgba(15,15,15,.85),rgba(15,15,15,.85)),url("assets/img/standings-bg.jpg");
  background-size:cover;background-attachment:fixed;
}
h2{text-align:center;margin-bottom:15px;font-weight:800}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse;font-size:14px}
th{background:#2b2b2b;padding:10px;font-weight:800;text-align:center}
td{padding:8px;text-align:center}
tr:nth-child(even){background:#1a1a1a}

.rank{
  background:#3a3a3a;
  font-weight:800;
}

/* ÿπŸÖŸàÿØ ÿßŸÑŸÑŸàÿ¨Ÿà ‚Äì ÿ£ŸÅÿ™ÿ≠ ÿ¥ŸàŸäÿ© ŸÖŸÜ # */
.logo-col{
  background:rgba(58,58,58,.6);
}

/* ===== TEAM NAME (only this is left aligned) ===== */
.team-name{
  text-align:left;
  padding-left:10px;
  white-space:nowrap;
}

/* clickable */
.team-click{cursor:pointer;}
.team-click:hover{text-decoration:underline;text-underline-offset:4px;}
.logo-col img{cursor:pointer}

/* ===== TEAM LOGOS ===== */
.team-logo{object-fit:contain;filter:drop-shadow(0 2px 6px rgba(0,0,0,.6));}
.logo-1{width:34px;height:34px;}
.logo-2{width:30px;height:30px;}
.logo-3{width:28px;height:28px;}
.logo-rest{width:24px;height:24px;}

/* ===== FORM ===== */
.form-box{display:flex;justify-content:center;gap:3px}
.form-box div{
  width:18px;height:18px;line-height:18px;
  font-size:12px;font-weight:800;
  border-radius:3px;color:#fff;
}
.form-W{background:#27ae60}
.form-L{background:#e74c3c}
.form-D{background:#7f8c8d}

/* ===== RULES ===== */
.rules-container{width:90%;margin:20px auto}
.rules-toggle{
  width:100%;background:#2b2b2b;color:#fff;
  border:none;padding:12px 20px;font-size:16px;
  font-weight:700;border-radius:8px;cursor:pointer;
  display:flex;justify-content:space-between
}
.rules-toggle:hover{background:#3498db}
.rules-content{
  max-height:0;overflow:hidden;transition:.5s;
  background:#1a1a1a;padding:0 20px;border-radius:8px
}
.rules-content.open{max-height:500px;padding:15px 20px}

/* ===== TEAM MODAL ===== */
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  padding:18px;
}
.modal.open{display:flex;}

.modal-card{
  width:min(980px, 100%);
  background:rgba(20,20,20,.95);
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.55);
  overflow:hidden;
}

.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  background:rgba(43,43,43,.9);
}
.modal-title{
  display:flex;
  align-items:center;
  gap:12px;
  font-weight:900;
  font-size:18px;
}
.modal-title img{
  width:34px;height:34px;object-fit:contain;
  filter:drop-shadow(0 2px 6px rgba(0,0,0,.6));
}
.modal-close{
  border:none;
  background:#3498db;
  color:#fff;
  font-weight:900;
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
}
.modal-close:hover{filter:brightness(1.05);}

.modal-body{
  padding:16px;
  display:grid;
  grid-template-columns: 1.2fr 1fr;
  gap:16px;
}
@media (max-width: 820px){
  .modal-body{grid-template-columns:1fr;}
}

.box{
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:14px;
}
.box h3{
  margin:0 0 10px 0;
  font-size:16px;
  font-weight:900;
  opacity:.95;
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:10px;
}
@media (max-width: 520px){
  .stats-grid{grid-template-columns:repeat(2, 1fr);}
}
.stat{
  background:rgba(30,30,30,.85);
  border-radius:12px;
  padding:10px 8px;
  text-align:center;
  border:1px solid rgba(255,255,255,.08);
}
.stat .label{font-size:12px;opacity:.85;font-weight:700;}
.stat .val{font-size:18px;font-weight:900;margin-top:4px;}

.meta-grid{
  display:grid;
  grid-template-columns:repeat(2, 1fr);
  gap:10px;
}
.meta{
  background:rgba(30,30,30,.85);
  border-radius:12px;
  padding:10px 10px;
  border:1px solid rgba(255,255,255,.08);
}
.meta .k{font-size:12px;opacity:.85;font-weight:700;}
.meta .v{font-size:14px;font-weight:900;margin-top:4px;word-break:break-word;}

.rating-row{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:10px;
}
.rating{
  background:rgba(30,30,30,.85);
  border-radius:12px;
  padding:10px 8px;
  text-align:center;
  border:1px solid rgba(255,255,255,.08);
}
.rating .k{font-size:12px;opacity:.85;font-weight:700;}
.rating .v{font-size:18px;font-weight:900;margin-top:4px;}

/* ===== Team scorers list ===== */
.team-scorers{
  margin-top:12px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.10);
}
.team-scorers-title{
  font-size:13px;
  font-weight:900;
  opacity:.9;
  margin-bottom:8px;
  text-align:left;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.scorers-list{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.scorer-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  background:rgba(30,30,30,.65);
  border:1px solid rgba(255,255,255,.08);
  padding:8px 10px;
  border-radius:12px;
}
.scorer-left{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.scorer-name{
  font-weight:900;
  text-align:left;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.scorer-badge{
  font-size:14px;
  line-height:1;
}
.scorer-goals{
  background:#3498db;
  border-radius:999px;
  padding:4px 10px;
  font-weight:900;
  font-size:12px;
  line-height:1;
  white-space:nowrap;
}
.scorer-empty{
  font-size:12px;
  opacity:.85;
  text-align:left;
  line-height:1.35;
}
.show-more-btn{
  border:none;
  background:rgba(52,152,219,.18);
  color:#fff;
  font-weight:900;
  border:1px solid rgba(52,152,219,.5);
  border-radius:10px;
  padding:6px 10px;
  cursor:pointer;
  font-size:12px;
}
.show-more-btn:hover{background:rgba(52,152,219,.28);}

/* ===== Team matches list ===== */
.team-matches{
  margin-top:12px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.10);
}
.team-matches-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.team-matches-title{font-size:13px;font-weight:900;opacity:.9;text-align:left;}
.matches-tabs{display:flex;gap:8px;flex-wrap:wrap;}
.mtab{
  border:none;cursor:pointer;font-weight:900;font-size:12px;color:#fff;
  padding:6px 10px;border-radius:999px;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.12);
}
.mtab.active{background:rgba(52,152,219,.35);border-color:rgba(52,152,219,.7);}
.mtab:hover{filter:brightness(1.05);}

.matches-wrap{
  width:100%;
  overflow:auto;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
}
.matches-table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  min-width:620px;
}
.matches-table th{
  background:rgba(43,43,43,.9);
  padding:10px 8px;
  text-align:center;
  font-weight:900;
  white-space:nowrap;
}
.matches-table td{
  padding:9px 8px;
  text-align:center;
  white-space:nowrap;
}
.matches-table tr:nth-child(even){background:rgba(26,26,26,.75);}

.match-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:4px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:11px;
  border:1px solid rgba(255,255,255,.12);
}
.badge-W{background:rgba(39,174,96,.25); border-color:rgba(39,174,96,.6);}
.badge-D{background:rgba(127,140,141,.25); border-color:rgba(127,140,141,.6);}
.badge-L{background:rgba(231,76,60,.25); border-color:rgba(231,76,60,.6);}

.match-empty{
  font-size:12px;
  opacity:.85;
  text-align:left;
  line-height:1.35;
  padding:10px 2px 0 2px;
}

/* ===== Biggest Win/Loss (clean cards) ===== */
.bwl-card{
  background:rgba(30,30,30,.85);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:12px;
}
.bwl-title{
  font-size:12px;
  font-weight:900;
  opacity:.85;
  margin-bottom:8px;
}
.bwl-line{
  font-size:13px;
  font-weight:900;
  line-height:1.3;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.bwl-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:26px;
  height:22px;
  padding:0 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.12);
}
.bwl-W{ background:rgba(39,174,96,.25); border-color:rgba(39,174,96,.55); }
.bwl-L{ background:rgba(231,76,60,.25); border-color:rgba(231,76,60,.55); }
.bwl-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<div class="page-header">
  <div class="logo-box">
    <img src="assets/img/left-logo.png" class="header-logo left" alt="Left Logo">
    <div class="player-points" id="left-points">Points: 0</div>
  </div>
  <div class="logo-box">
    <img src="assets/img/right-logo.png" class="header-logo right" alt="Right Logo">
    <div class="player-points" id="right-points">Points: 0</div>
  </div>
</div>

<nav>
  <a href="index.html" class="active">Standings</a>
  <a href="pages/matches.html">Matches</a>
  <a href="pages/scorers.html">Scorers</a>
  <a href="pages/squads.html">Squads</a>
</nav>

<h2>League Table</h2>

<table>
<thead>
<tr>
  <th>#</th>
  <th colspan="2">Team</th>
  <th>P</th>
  <th>W</th>
  <th>D</th>
  <th>L</th>
  <th>DIFF</th>
  <th>G/S</th>
  <th>G/C</th>
  <th>Points</th>
  <th>Owner</th>
  <th>Form</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="rules-container">
  <button class="rules-toggle">Rules ‚ñº</button>
  <div class="rules-content">
    <ol>
      <li>Points</li>
      <li>Goal Difference</li>
      <li>Goals Scored</li>
      <li>Goals Conceded</li>
    </ol>
  </div>
</div>

<!-- ===== TEAM STATS MODAL ===== -->
<div id="teamModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title">
        <img id="modalLogo" src="" alt="Team Logo" onerror="this.style.display='none'">
        <span id="modalTeamName">Team</span>
      </div>
      <button id="modalClose" class="modal-close">Close ‚úï</button>
    </div>

    <div class="modal-body">
      <div class="box">
        <h3>Match Stats</h3>
        <div class="stats-grid">
          <div class="stat"><div class="label">Played</div><div class="val" id="mP">0</div></div>
          <div class="stat"><div class="label">Won</div><div class="val" id="mW">0</div></div>
          <div class="stat"><div class="label">Draw</div><div class="val" id="mD">0</div></div>
          <div class="stat"><div class="label">Lost</div><div class="val" id="mL">0</div></div>

          <div class="stat"><div class="label">Goals For</div><div class="val" id="mGF">0</div></div>
          <div class="stat"><div class="label">Goals Against</div><div class="val" id="mGA">0</div></div>
          <div class="stat"><div class="label">Goal Diff</div><div class="val" id="mGD">0</div></div>
          <div class="stat"><div class="label">Points</div><div class="val" id="mPTS">0</div></div>
        </div>

        <!-- Team scorers with show more -->
        <div class="team-scorers">
          <div class="team-scorers-title">
            <span>Team Scorers</span>
            <button id="scorersToggleBtn" class="show-more-btn" style="display:none;">Show more</button>
          </div>
          <div id="teamScorersBox" class="scorers-list"></div>
        </div>

        <!-- Team matches -->
        <div class="team-matches">
          <div class="team-matches-head">
            <div class="team-matches-title">Team Matches</div>
            <div class="matches-tabs">
              <button id="tabPlayed" class="mtab active" type="button">Played</button>
              <button id="tabUpcoming" class="mtab" type="button">Upcoming</button>
            </div>
          </div>

          <div class="matches-wrap">
            <table class="matches-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Home</th>
                  <th>Score</th>
                  <th>Away</th>
                  <th>Result</th>
                </tr>
              </thead>
              <tbody id="teamMatchesBody"></tbody>
            </table>
          </div>

          <div id="teamMatchesEmpty" class="match-empty" style="display:none;"></div>
        </div>
      </div>

      <div class="box">
        <h3>Team Info</h3>
        <div class="rating-row">
          <div class="rating"><div class="k">ATT</div><div class="v" id="tATT">-</div></div>
          <div class="rating"><div class="k">MID</div><div class="v" id="tMID">-</div></div>
          <div class="rating"><div class="k">DEF</div><div class="v" id="tDEF">-</div></div>
          <div class="rating"><div class="k">AVR</div><div class="v" id="tAVR">-</div></div>
        </div>

        <div style="height:10px"></div>

        <div class="meta-grid">
          <div class="meta"><div class="k">Owner</div><div class="v" id="tOwner">-</div></div>
          <div class="meta"><div class="k">Country</div><div class="v" id="tCountry">-</div></div>
          <div class="meta"><div class="k">Level</div><div class="v" id="tLevel">-</div></div>
          <div class="meta"><div class="k">International Rank</div><div class="v" id="tRank">-</div></div>
          <div class="meta" style="grid-column:1/-1"><div class="k">Key Player</div><div class="v" id="tKey">-</div></div>

          <!-- ‚úÖ Biggest Results (2 clean cards) -->
          <div class="meta" style="grid-column:1/-1">
            <div class="k">Biggest Results</div>

            <div class="bwl-card" style="margin-top:8px;">
              <div class="bwl-head">
                <div class="bwl-title">Biggest Win</div>
                <span class="bwl-badge bwl-W" id="bwBadge" style="display:none;">W</span>
              </div>
              <div class="bwl-line" id="bwLine">-</div>
            </div>

            <div class="bwl-card" style="margin-top:10px;">
              <div class="bwl-head">
                <div class="bwl-title">Biggest Loss</div>
                <span class="bwl-badge bwl-L" id="blBadge" style="display:none;">L</span>
              </div>
              <div class="bwl-line" id="blLine">-</div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
const standingsURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=1129539507&single=true&output=csv";
const formURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=882748508&single=true&output=csv";

const matchesURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=866991516&single=true&output=csv";
const teamsURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=0&single=true&output=csv";
const scorersURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT54W8eLRnu7YjOYR49uv-FWsBL1VZR3JUptdsdaP7gYmVIyrtHEmoOd0ZR0uaAijzMXbAhmweN1_5n/pub?gid=940156222&single=true&output=csv";

function parseCSV(t){
  return t.trim().split("\n").map(r =>
    r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,"").trim())
  );
}
function teamLogoSrc(name){
  return `assets/img/logos/${encodeURIComponent(name)}.png`;
}
function normalizeResult(value){
  const v = String(value || "").trim().toLowerCase();
  if(!v) return "";
  if(v === "w" || v === "win" || v === "won") return "W";
  if(v === "l" || v === "lost" || v === "loss" || v === "lose") return "L";
  if(v === "d" || v === "draw" || v === "tie") return "D";
  return "";
}

/* ===== DATA STORES ===== */
let teamInfoByName = {};
let matchStatsByTeam = {};
let teamScorersByTeam = {};
let teamMatchesByTeam = {};

/* ===== SHOW MORE STATE ===== */
let currentTeamForScorers = "";
let scorersExpanded = false;
const SCORERS_LIMIT = 5;

/* ===== MATCHES TAB STATE ===== */
let currentTeamForMatches = "";
let matchesView = "Played";

/* ===== BUILDERS ===== */
function buildTeamInfo(teamsCSV){
  const rows = parseCSV(teamsCSV).slice(1);
  teamInfoByName = {};
  rows.forEach(r=>{
    const name = (r[1] || "").trim();
    if(!name) return;

    const att = +r[8] || 0;
    const mid = +r[9] || 0;
    const def = +r[10] || 0;
    const avr = Math.round((att + mid + def) / 3);

    teamInfoByName[name] = {
      name,
      country: r[3] || "-",
      level: r[5] || "-",
      owner: r[6] || "-",
      rank: r[7] || "-",
      att, mid, def, avr,
      keyPlayer: r[11] || "-",
      keyRating: r[12] || "-",
      keyPos: r[13] || "-"
    };
  });
}

function buildMatchStats(matchesCSV){
  const rows = parseCSV(matchesCSV).slice(1);
  matchStatsByTeam = {};

  function ensure(team){
    if(!matchStatsByTeam[team]){
      matchStatsByTeam[team] = {
        P:0,W:0,D:0,L:0,GF:0,GA:0,PTS:0,
        biggestWin:null,
        biggestLoss:null
      };
    }
    return matchStatsByTeam[team];
  }

  function maybeSetBiggestWin(statsObj, diff, match){
    if(diff <= 0) return;
    if(!statsObj.biggestWin || diff > statsObj.biggestWin.diff){
      statsObj.biggestWin = { diff, ...match };
    }
  }
  function maybeSetBiggestLoss(statsObj, diff, match){
    if(diff <= 0) return;
    if(!statsObj.biggestLoss || diff > statsObj.biggestLoss.diff){
      statsObj.biggestLoss = { diff, ...match };
    }
  }

  rows.forEach(m=>{
    const status = (m[15] || "").trim();
    if(status !== "Played") return;

    const h = (m[2] || "").trim();
    const a = (m[11] || "").trim();
    const hs = +m[6] || 0;
    const as = +m[7] || 0;
    const matchId = (m[1] || "").trim();
    if(!h || !a) return;

    const home = ensure(h);
    const away = ensure(a);

    home.P++; away.P++;
    home.GF += hs; home.GA += as;
    away.GF += as; away.GA += hs;

    if(hs === as){
      home.D++; away.D++;
      home.PTS += 1; away.PTS += 1;
    } else if(hs > as){
      home.W++; away.L++;
      home.PTS += 3;
    } else {
      away.W++; home.L++;
      away.PTS += 3;
    }

    const matchObj = { matchId, home:h, away:a, hs, as };
    const homeDiff = hs - as;
    const awayDiff = as - hs;

    if(homeDiff > 0){
      maybeSetBiggestWin(home, homeDiff, matchObj);
      maybeSetBiggestLoss(away, homeDiff, matchObj);
    } else if(awayDiff > 0){
      maybeSetBiggestWin(away, awayDiff, matchObj);
      maybeSetBiggestLoss(home, awayDiff, matchObj);
    }
  });
}

function buildTeamScorers(scorersCSV){
  const rows = parseCSV(scorersCSV).slice(1);
  teamScorersByTeam = {};

  rows.forEach(r=>{
    const team = (r[2] || "").trim();
    const player = (r[3] || "").trim();
    if(!team || !player) return;

    if(!teamScorersByTeam[team]) teamScorersByTeam[team] = {};
    teamScorersByTeam[team][player] = (teamScorersByTeam[team][player] || 0) + 1;
  });
}

function buildTeamMatches(matchesCSV){
  const rows = parseCSV(matchesCSV).slice(1);
  teamMatchesByTeam = {};

  function push(team, item){
    if(!teamMatchesByTeam[team]) teamMatchesByTeam[team] = [];
    teamMatchesByTeam[team].push(item);
  }

  rows.forEach(m=>{
    const matchId = (m[1] || "").trim();
    const home = (m[2] || "").trim();
    const away = (m[11] || "").trim();
    const hs = m[6];
    const as = m[7];
    const status = (m[15] || "").trim();
    if(!matchId || !home || !away || !status) return;

    const item = {
      matchId,
      home,
      away,
      hs: (hs === "" || hs == null) ? "" : +hs,
      as: (as === "" || as == null) ? "" : +as,
      status
    };

    push(home, item);
    push(away, item);
  });

  Object.keys(teamMatchesByTeam).forEach(team=>{
    teamMatchesByTeam[team].sort((a,b)=> (+a.matchId) - (+b.matchId));
  });
}

/* ===== SCORERS RENDER ===== */
function getSortedScorers(teamName){
  const playersMap = teamScorersByTeam[teamName] || null;
  if(!playersMap) return [];

  return Object.entries(playersMap)
    .map(([player, goals]) => ({ player, goals }))
    .sort((a,b)=> b.goals - a.goals || a.player.localeCompare(b.player));
}

function renderTeamScorers(teamName){
  const box = document.getElementById("teamScorersBox");
  const btn = document.getElementById("scorersToggleBtn");

  box.innerHTML = "";

  const listAll = getSortedScorers(teamName);
  if(listAll.length === 0){
    btn.style.display = "none";
    box.innerHTML = `<div class="scorer-empty">No goals recorded yet for this team.</div>`;
    return;
  }

  const showList = scorersExpanded ? listAll : listAll.slice(0, SCORERS_LIMIT);
  const topGoals = listAll[0].goals;

  showList.forEach(item=>{
    const row = document.createElement("div");
    row.className = "scorer-item";
    const isTop = item.goals === topGoals;

    row.innerHTML = `
      <div class="scorer-left">
        ${isTop ? `<span class="scorer-badge">ü•á</span>` : ``}
        <div class="scorer-name">${item.player}</div>
      </div>
      <div class="scorer-goals">${item.goals} G</div>
    `;
    box.appendChild(row);
  });

  if(listAll.length > SCORERS_LIMIT){
    btn.style.display = "inline-flex";
    btn.textContent = scorersExpanded ? "Show less" : "Show more";
  } else {
    btn.style.display = "none";
  }
}

/* ===== MATCHES RENDER ===== */
function calcTeamResult(team, match){
  if(match.status !== "Played") return "";
  const hs = Number(match.hs);
  const as = Number(match.as);
  if(!Number.isFinite(hs) || !Number.isFinite(as)) return "";
  if(hs === as) return "D";
  if(match.home === team) return (hs > as) ? "W" : "L";
  return (as > hs) ? "W" : "L";
}

function renderTeamMatches(teamName){
  const body = document.getElementById("teamMatchesBody");
  const empty = document.getElementById("teamMatchesEmpty");
  body.innerHTML = "";
  empty.style.display = "none";
  empty.textContent = "";

  const allMatches = teamMatchesByTeam[teamName] || [];
  const list = allMatches.filter(m => m.status === matchesView);

  if(list.length === 0){
    empty.style.display = "block";
    empty.textContent = matchesView === "Played"
      ? "No played matches recorded for this team yet."
      : "No upcoming matches for this team.";
    return;
  }

  list.forEach(m=>{
    const res = calcTeamResult(teamName, m);
    const scoreText = (m.status === "Played" && Number.isFinite(m.hs) && Number.isFinite(m.as))
      ? `${m.hs} - ${m.as}`
      : "-";

    let badgeHTML = `<span class="match-badge badge-D">-</span>`;
    if(res === "W") badgeHTML = `<span class="match-badge badge-W">W</span>`;
    if(res === "D") badgeHTML = `<span class="match-badge badge-D">D</span>`;
    if(res === "L") badgeHTML = `<span class="match-badge badge-L">L</span>`;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${m.matchId}</td>
      <td>${m.home}</td>
      <td>${scoreText}</td>
      <td>${m.away}</td>
      <td>${m.status === "Played" ? badgeHTML : `<span class="match-badge badge-D">Upcoming</span>`}</td>
    `;
    body.appendChild(tr);
  });
}

/* ===== MODAL ===== */
function openTeamModal(teamName){
  const modal = document.getElementById("teamModal");
  const info = teamInfoByName[teamName] || null;
  const st = matchStatsByTeam[teamName] || {
    P:0,W:0,D:0,L:0,GF:0,GA:0,PTS:0,
    biggestWin:null,biggestLoss:null
  };

  document.getElementById("modalTeamName").textContent = teamName;

  const logo = document.getElementById("modalLogo");
  logo.style.display = "";
  logo.src = teamLogoSrc(teamName);
  logo.alt = teamName;

  // Match stats
  document.getElementById("mP").textContent = st.P;
  document.getElementById("mW").textContent = st.W;
  document.getElementById("mD").textContent = st.D;
  document.getElementById("mL").textContent = st.L;
  document.getElementById("mGF").textContent = st.GF;
  document.getElementById("mGA").textContent = st.GA;
  document.getElementById("mGD").textContent = (st.GF - st.GA);
  document.getElementById("mPTS").textContent = st.PTS;

  // Biggest Win/Loss (clean)
  const bw = st.biggestWin;
  const bl = st.biggestLoss;

  const bwLine = document.getElementById("bwLine");
  const blLine = document.getElementById("blLine");
  const bwBadge = document.getElementById("bwBadge");
  const blBadge = document.getElementById("blBadge");

  if (bw) {
    bwLine.textContent = `${bw.home} ${bw.hs}-${bw.as} ${bw.away}`;
    bwBadge.style.display = "inline-flex";
    bwBadge.textContent = "W";
  } else {
    bwLine.textContent = "-";
    bwBadge.style.display = "none";
  }

  if (bl) {
    blLine.textContent = `${bl.home} ${bl.hs}-${bl.as} ${bl.away}`;
    blBadge.style.display = "inline-flex";
    blBadge.textContent = "L";
  } else {
    blLine.textContent = "-";
    blBadge.style.display = "none";
  }

  // scorers reset
  currentTeamForScorers = teamName;
  scorersExpanded = false;
  renderTeamScorers(teamName);

  // matches reset
  currentTeamForMatches = teamName;
  matchesView = "Played";
  document.getElementById("tabPlayed").classList.add("active");
  document.getElementById("tabUpcoming").classList.remove("active");
  renderTeamMatches(teamName);

  // Team info
  document.getElementById("tATT").textContent = info ? info.att : "-";
  document.getElementById("tMID").textContent = info ? info.mid : "-";
  document.getElementById("tDEF").textContent = info ? info.def : "-";
  document.getElementById("tAVR").textContent = info ? info.avr : "-";

  document.getElementById("tOwner").textContent = info ? info.owner : "-";
  document.getElementById("tCountry").textContent = info ? info.country : "-";
  document.getElementById("tLevel").textContent = info ? info.level : "-";
  document.getElementById("tRank").textContent = info ? info.rank : "-";
  document.getElementById("tKey").textContent = info
    ? `‚≠ê ${info.keyPlayer} (${info.keyPos} ‚Ä¢ ${info.keyRating})`
    : "-";

  modal.classList.add("open");
  modal.setAttribute("aria-hidden","false");
}

function closeTeamModal(){
  const modal = document.getElementById("teamModal");
  modal.classList.remove("open");
  modal.setAttribute("aria-hidden","true");
}

/* Close handlers */
document.getElementById("modalClose").addEventListener("click", closeTeamModal);
document.getElementById("teamModal").addEventListener("click", (e)=>{
  if(e.target.id === "teamModal") closeTeamModal();
});
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") closeTeamModal();
});

/* Show more toggle */
document.getElementById("scorersToggleBtn").addEventListener("click", ()=>{
  if(!currentTeamForScorers) return;
  scorersExpanded = !scorersExpanded;
  renderTeamScorers(currentTeamForScorers);
});

/* Matches tabs */
document.getElementById("tabPlayed").addEventListener("click", ()=>{
  if(!currentTeamForMatches) return;
  matchesView = "Played";
  document.getElementById("tabPlayed").classList.add("active");
  document.getElementById("tabUpcoming").classList.remove("active");
  renderTeamMatches(currentTeamForMatches);
});
document.getElementById("tabUpcoming").addEventListener("click", ()=>{
  if(!currentTeamForMatches) return;
  matchesView = "Upcoming";
  document.getElementById("tabUpcoming").classList.add("active");
  document.getElementById("tabPlayed").classList.remove("active");
  renderTeamMatches(currentTeamForMatches);
});

/* ===== LOAD EVERYTHING ===== */
Promise.all([
  fetch(formURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text()),
  fetch(standingsURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text()),
  fetch(matchesURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text()),
  fetch(teamsURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text()),
  fetch(scorersURL + "&t=" + Date.now(), { cache:"no-store" }).then(r=>r.text())
]).then(([formCSV, standingsCSV, matchesCSV, teamsCSV, scorersCSV])=>{

  buildTeamInfo(teamsCSV);
  buildMatchStats(matchesCSV);
  buildTeamMatches(matchesCSV);
  buildTeamScorers(scorersCSV);

  // Form sheet
  const formParsed = parseCSV(formCSV);
  const formHeaders = (formParsed[0] || []).slice(1).map(h=>h.trim().toLowerCase());
  const formData = formParsed.slice(1).map(r=>r.slice(1));

  // Standings table
  const rows = parseCSV(standingsCSV).slice(1,18);
  const tbody = document.querySelector("tbody");
  tbody.innerHTML = "";

  const pointsByOwner = {};

  rows.forEach((c,i)=>{
    if(!c[3]) return;

    const team = (c[2] || "").trim();
    const owner = c[11];
    const pts = +c[10] || 0;

    pointsByOwner[owner] = (pointsByOwner[owner]||0) + pts;

    let logoClass =
      i===0 ? "logo-1" :
      i===1 ? "logo-2" :
      i===2 ? "logo-3" : "logo-rest";

    // FORM
    let idx = formHeaders.indexOf(team.toLowerCase());
    let formHTML = "";
    if(idx>-1){
      formHTML='<div class="form-box">';
      formData.forEach(r=>{
        const res = normalizeResult(r[idx]);
        if(res==="W") formHTML+='<div class="form-W">W</div>';
        else if(res==="L") formHTML+='<div class="form-L">L</div>';
        else if(res==="D") formHTML+='<div class="form-D">D</div>';
      });
      formHTML+='</div>';
    }

    tbody.innerHTML += `
    <tr data-team="${team}">
      <td class="rank">${i+1}</td>
      <td class="logo-col">
        <img class="team-logo ${logoClass}"
             src="${teamLogoSrc(team)}"
             alt="${team}"
             onerror="this.style.display='none'">
      </td>
      <td class="team-name team-click">${team}</td>
      <td>${c[3]}</td>
      <td>${c[4]}</td>
      <td>${c[5]}</td>
      <td>${c[6]}</td>
      <td>${c[7]}</td>
      <td>${c[8]}</td>
      <td>${c[9]}</td>
      <td>${c[10]}</td>
      <td>${c[11]}</td>
      <td>${formHTML}</td>
    </tr>`;
  });

  document.getElementById("left-points").textContent =
    "Points: " + (pointsByOwner["Ahmed Ibrahem"]||0);
  document.getElementById("right-points").textContent =
    "Points: " + (pointsByOwner["Abdoulrahman Atef"]||0);

  // Click handlers for teams (logo OR name)
  tbody.querySelectorAll("tr[data-team]").forEach(tr=>{
    const teamName = tr.getAttribute("data-team");
    const logoTd = tr.children[1];
    const nameTd = tr.querySelector(".team-name");
    logoTd.addEventListener("click", ()=> openTeamModal(teamName));
    nameTd.addEventListener("click", ()=> openTeamModal(teamName));
  });

}).catch(err => console.error("Error loading sheets:", err));

/* Rules toggle */
document.querySelector(".rules-toggle").addEventListener("click", function() {
  const content = document.querySelector(".rules-content");
  content.classList.toggle("open");
  this.innerHTML = content.classList.contains("open") ? "Rules ‚ñ≤" : "Rules ‚ñº";
});

// ‚úÖ Go to player comparison page when clicking the top logos
document.querySelectorAll(".logo-box").forEach(box=>{
  box.addEventListener("click", ()=>{
    window.location.href = "pages/player-stats.html";
  });
});
</script>

</body>
</html>
